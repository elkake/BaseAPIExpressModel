<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Sign in</title>
</head>
<body>
    <h1>Google Sign in</h1>

    <div id="g_id_onload"
    data-client_id="74827720808-roms9in80rns0s06mqh3a33svn42ftg7.apps.googleusercontent.com"
    data-auto_prompt="false"
    data-callback="handleCredentialResponse"
    >
</div>
<div class="g_id_signin"
data-type="standard"
data-size="large"
data-theme="outline"
data-text="sign_in_with"
data-shape="rectangular"
data-logo_alignment="left">
</div>
<button id="signout">Sign out</button>
</body>
<script src="https://accounts.google.com/gsi/client" async defer></script>
<script>
    function handleCredentialResponse(response) {

        console.log(response.credential)
        
       const body={id_token:response.credential}
    //    console.log(response.credential)
    fetch('http://localhost:3000/api/auth/google',{
        method:'POST',
        headers:{
            'Content-Type':'application/json'
        },
        body:JSON.stringify(body)
    })
    .then(e=>e.json())
    .then(e=>{
        
        console.log(e)
        console.log(e.usuario.correo)
        localStorage.setItem('email',e.usuario.correo)
        location.reload()
    }).catch(console.warn)

    }

    const button=document.getElementById('signout')
    button.onclick=()=>{
        console.log(google.accounts.id)
        // evita mostrar la cuenta que se utilizo anteriormente 
        google.accounts.id.disableAutoSelect()
        // hace la desconexion de google sign in
        google.accounts.id.revoke(localStorage.getItem('email'),done=>{
            // limpia el localstorage
            localStorage.clear();
            // recarga la pagina y vacia cuaalquier cosa que tengamos en nuestra app
            location.reload()
        })
    }
  </script>
</html>
<!-- data-login_uri="https://your.domain/your_login_endpoint" -->